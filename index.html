<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" type="text/css" href="todo.css" />

</head>
<body>

<form>
  <label for="todo-input">할 일</label>
  <input type="text" id="todo-input" placeholder="할 일을 입력하세요." required/>
  <button id="add-button">추가</button>
</form>
<div id="container">
  <ul id="todo-list">
    <!-- <div class="todo">
      <li class="todo-content">내용</li>
      <button class="complete-button">완료</button>
      <button class="delete-button">삭제</button>
    </div> -->
  </ul>
</div>
<button id="getLocation">위치정보</button>
<div id="map" style="width:100%;height:350px;"></div>

<!-- <script src="todo.js"></script> -->

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ac42de0e44a04d045cb4b28780c94ea6"></script>
<!-- <script>
  var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
      mapOption = { 
          center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
          level: 5 // 지도의 확대 레벨 
      }; 
  
  var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
  
  // HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
  if (navigator.geolocation) {
      
      // GeoLocation을 이용해서 접속 위치를 얻어옵니다
      navigator.geolocation.getCurrentPosition(function(position) {
          
          var lat = position.coords.latitude, // 위도
              lon = position.coords.longitude; // 경도
          
          var locPosition = new kakao.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
              message = '<div style="padding:5px;">여기에 계신가요?!</div>'; // 인포윈도우에 표시될 내용입니다
          
          // 마커와 인포윈도우를 표시합니다
          displayMarker(locPosition, message);
              
        });
      
  } else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다
      
      var locPosition = new kakao.maps.LatLng(lat, lon),    
          message = 'geolocation을 사용할수 없어요..'
          
      displayMarker(locPosition, message);
  }
  
  // 지도에 마커와 인포윈도우를 표시하는 함수입니다
  function displayMarker(locPosition, message) {
  
      // 마커를 생성합니다
      var marker = new kakao.maps.Marker({  
          map: map, 
          position: locPosition
      }); 
      
      var iwContent = message, // 인포윈도우에 표시할 내용
          iwRemoveable = true;
  
      // 인포윈도우를 생성합니다
      var infowindow = new kakao.maps.InfoWindow({
          content : iwContent,
          removable : iwRemoveable
      });
      
      // 인포윈도우를 마커위에 표시합니다 
      infowindow.open(map, marker);
      
      // 지도 중심좌표를 접속위치로 변경합니다
      map.setCenter(locPosition);      
  }    
  </script> -->

<script>



 // 지도에 마커와 인포윈도우를 표시하는 함수입니다
 function displayMarker(locPosition, message) {
  
  // 마커를 생성합니다
  var marker = new kakao.maps.Marker({  
      map: map, 
      position: locPosition
  }); 
  
  var iwContent = message, // 인포윈도우에 표시할 내용
      iwRemoveable = true;

  // 인포윈도우를 생성합니다
  var infowindow = new kakao.maps.InfoWindow({
      content : iwContent,
      removable : iwRemoveable
  });
  
  // 인포윈도우를 마커위에 표시합니다 
  infowindow.open(map, marker);
  
  // 지도 중심좌표를 접속위치로 변경합니다
  map.setCenter(locPosition);      
}    

function getMap(){
  console.log("getMap");
  navigator.geolocation.getCurrentPosition(function(position) {
          
          var lat = position.coords.latitude, // 위도
              lon = position.coords.longitude; // 경도

              console.log(`lat : ${lat}, lon ; ${lon}`);
        
              var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
              mapOption = { 
                  center: new kakao.maps.LatLng(lat, lon), // 지도의 중심좌표
                  level: 3 // 지도의 확대 레벨 
              }; 
          
          var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다    
          // 마커와 인포윈도우를 표시합니다

          var locPosition = new kakao.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
              message = '<div style="padding:5px;">여기에 계신가요?!</div>'; // 인포윈도우에 표시될 내용입니다
          displayMarker(locPosition, message);

        });

      
}
document.addEventListener("DOMContentLoaded",getMap);







  function showPosition(){
    console.log("callback 실행");
     navigator.geolocation.getCurrentPosition(function(position) {
          
          var lat = position.coords.latitude, // 위도
              lon = position.coords.longitude; // 경도
          
          var locPosition = new kakao.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
              message = '<div style="padding:5px;">여기에 계신가요?!</div>'; // 인포윈도우에 표시될 내용입니다
          
          // 마커와 인포윈도우를 표시합니다
          displayMarker(locPosition, message);
              
        });
  }

  function errorPosition(err) {
    alert(err.message);
  }




getLocation.addEventListener("click",function(e){
    e.preventDefault();
    if(navigator.geolocation) {

      
      navigator.geolocation.getCurrentPosition(function(position) {
          
          var lat = position.coords.latitude, // 위도
              lon = position.coords.longitude; // 경도
          
          var locPosition = new kakao.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
              message = '<div style="padding:5px;">여기에 계신가요?!</div>'; // 인포윈도우에 표시될 내용입니다
          
          // 마커와 인포윈도우를 표시합니다
          displayMarker(locPosition, message);
              
        });
      
      const options = {
        enableHighAccuracy : true,
        timeout:5000,  
        maximumAge : 0
      };

      let watchId = navigator.geolocation.watchPosition(showPosition, errorPosition, options);

      setTimeout(function(){
        navigator.geolocation.clearWatch(watchId);
      },30000);


    }else{
      alert("지오로케이션을 지원하지 않습니다.");
    }
 });

</script>
</body>
</html>